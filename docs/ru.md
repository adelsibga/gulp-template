# Gulp сборка

Сборка Gulp для верстки и разработки. [English](../README.md)

## Основные фичи

- SCSS/SASS/LESS
- TWIG
- Минимизация скриптов, стилей, картинок, html
- Линтинг кода
- Конвертация картинок в __webp__, __avif__

### Скоро

- добавление babel
- модульность js с помощью webpack
- Поправить документацию в соответствии с изменениями по gulpfile.js и добавлением линтеров
- Проверить работоспособность less и sass
- Подключение различных библиотек стилей и скриптов
- SVG спрайты
- Добавление english документации
- use forward вместо import где это уместно
- husky для прекоммита
- lint-staged
- Добавить возможность запускать команды из README.md
- https://habr.com/ru/companies/tinkoff/articles/497282/

## Установка

Для работы с данной сборкой в новом проекте склонируйте все содержимое репозитория

```
git clone https://github.com/adelsibga/gulp-template.git
```

Затем, находясь в корне проекта, запустите команду `npm i`, которая установит все находящиеся в `package.json` зависимости и `npm i gulp -g`, которая
установит gulp для работы данной сборки.
После этого можно использовать любую из предложенных [команд](#команды) (полученные файлы помещаются в папку build в корневом каталоге)

## Структура папок и файлов

```
├── build                         # Папка с собранным проектом
├── docs                          # Папка с документацией
├── gulp
│   ├── config
│   ├── tasks
├── src                           # Рабочая директория
│   ├── assets                    # Папка для хранения ассетов - json, php, video files, и т.д.
│   ├── components                # Папка для хранения компонентов в формате twig
│   ├── fonts                     # Папка для хранения шрифтов
│   ├── images                    # Папка для хранения картинок
│   │   ├── favicon               # Папка для хранения favicon
│   ├── js                        # Скрипты
│   │   ├── components            # JS компоненты
│   │   ├── utils                 # Папка с утилитами
│   │   └── index.js              # Главный файл скриптов
│   ├── less                      # Стили (less синтаксис)
│   ├── sass                      # Стили (sass синтаксис)
│   ├── scss                      # Стили (scss синтаксис)
│   │   ├── components            # Паска с компонентами стилей
│   │   ├── config                # Папка с конфигурационными файлами
│   │   │   └── _fonts.scss       # Файл для подключения шрифтов
│   │   │   └── _vars.scss        # Файл констант
│   │   ├── mixins                # Папка с миксинами
│   │   │   └── fontFace.scss     # Миксин для шрифтов
│   │   └── index.scss            # Главный файл стилей
│   ├── templates                 # Папка для хранения шаблонов twig файлов
│   │   └── layout.twig           # Файл с шаблоном
│   └── index.twig                # Главный twig файл
└── .gitignore                    # Файл .gitignore нужен, чтобы скрыть файлы и папки от системы контроля версий Git
└── gulpfile.js                   # Файл настроек Gulp
└── package.json                  # Файл с настройками сборки и установленными пакетами
└── package-lock.json             # Файл package-lock.json используется для фиксации зависимостей к определенному номеру версии
└── README.md                     # Документация по сборке
```

## Оглавление

1. [npm-скрипты](#npm-скрипты)
2. [Команды](#команды)
3. [Работа с Twig](#работа-с-twig)
4. [Работа со стилями](#работа-со-стилями)
5. [Работа с JS](#работа-с-JS)
6. [Работа со шрифтами](#работа-со-шрифтами)
7. [Работа с изображениями](#работа-с-изображениями)
8. [Работа с иными ресурсами](#работа-с-иными-ресурсами)
9. [Заключегие](#заключение)

## npm-скрипты

### Stylelint

В сборке есть возможность проверять код стилей на соответствие конфигу (.stylelintrc).

`npm run lint:stylelint` - запустит линтер и выведет в консоль список ошибок.

`npm run fix:stylelint` - дополнительно исправит ошибки, доступные для автоисправления.

> Для отключения какой-либо ошибки в файле используйте `// stylelint-disable order/order`, где __order/order__ - название правила

Более подробно про stylelint можно прочитать в [Документации](https://stylelint.io/)

### ESLint

Можно проверить скрипты на соответствие конфигу (.eslintrc.json)

`npm run lint:eslint` - запустит линтер и выведет в консоль список ошибок.

`npm run fix:eslint` - дополнительно исправит ошибки, доступные для автоисправления.

> Для отключения какой-либо ошибки в файле используйте `/* eslint-disable-next-line eqeqeq */`, где __eqeqeq__ - название правила

Более подробно про eslint можно прочитать в [Документации](https://eslint.org/)

### Линтеры

Так же можно запустить все скрипты **lint** одной командой
```shell
npm run lint
```

**lint:fix** 
```shell
npm run fix
```

### Другие скрипты

Так же есть __prod__ сборка
`npm run prod` - запустил команду `gulp build` с флагом `--prod`
Отличие prod сборки от обычного билда в том, что отсутствуют sourcemap у стилей и скриптов и минимизируется html.

## Команды

1. `gulp twig2Html` - собирает twig в html
2. `gulp styles` - собирает стили
3. `gulp scripts` - собирает js скрипты
4. `gulp images` - сжимает и оптимизирует картинки
5. `gulp fonts` - перегоняет шрифты в build директорию
6. `gulp assets` - перегоняет все файлы из assets в build директорию
7. `gulp clean` - очищает build директорию
8. `gulp build` - выполняет все таски описанные выше
9. `gulp` - запускает таск `gulp build`, поднимает browserSync и автоматически перезагружает браузер

## Работа с Twig

Благоддаря плагину gulp-twig вы можете разделять верстку на различные части, шаблоны, компоненты, которые должны хранитсья в папке components.
Удобно делить страницу на секции.
> Для вставки частей в файлы используйте `{% include './components/filename.twig' %}`.

> Для использования шаблонов страниц в новом twig файле используйте `{% extends 'templates/layout.twig' %}`.

В задаче twig используется пакет replace для алиасов:

- @img/ будет заменено на ./images/
- @fonts/ будет заменено на ./fonts/

Сделано для того, чтобы пути были правильными в папке с результатом

Более подробно про twig можно прочитать в [документации](https://twig.symfony.com/doc/3.x/).

## Работа со стилями

В сборке используются препроцессоры: __less__ и __sass__ в синтаксисе __scss__ и __sass__.
Смена препроцессора происходит в файле ```gulpfile.js```.
Чтобы использовать синтаксис __scss__, нужно заменить значение переменной ```preprocessor``` на __scss__ ```let preprocessor = 'scss'```.

В задаче стилей используется пакет replace для алиасов:

- @img/ будет заменено на ../images/
- @fonts/ будет заменено на ../fonts/

Сделано для того, чтобы пути были правильными в папке с результатом

TODO: Чтобы подключить сторонние css-файлы (библиотеки) - положите их в папку __vendor__ и подключите в файле ```_vendor.scss```.

Если вы хотите создать свой миксин - делайте это в папке __mixins__, а затем подключайте в файл ```_.scss```.

Стили, написанные в __components__, следует подключать в __index.scss__.

При использовании команды `gulp build`, вы получите минифицированный css-код в одну строку для всех css-файлов.

## Работа с JS

TODO: Подключать сторонние библиотеки можно через npm, для этого существует файл ```vendor.js```. Импортируйте туда подключения.
TODO: Написать про модульность и что она работает

При использовании команды `gulp build`, вы получите минифицированный js-код в одну строку для всех js-файлов.

## Работа со шрифтами

Используется поддержка шрифтов только формата woff2.

Шрифты формата ttf автоматически конвертируются в woff2.

Шрифты формата woff2 будут автоматически выгружаться в build директорию

Для упрощения подключения шрифтов используйте миксин, который находится в `fontFace.scss`.

```scss
@include font-face('Euclid Circular B Bold', '../fonts/EuclidCircularB/EuclidCircularB-Bold', bold, normal);
```

> Первый параметр ```$font-family``` - служит для определения семейства шрифтов.

> Второй параметр ```$url``` - путь до файла шрифта.

> Третий параметр ```$weight``` - отвечает за жирность шрифта.

> Четвертый параметр ```$style``` - отвечает за стиль шрифта.

Загружайте файлы шрифтов в папку `fonts`, а затем вызывайте миксин `@font-face` из `fontFace.scss`.
Также не забудьте прописать эти же шрифты в ```<link preload>``` в верстке, используя компонент ```preload/fonts.twig```.

## Работа с изображениями

Все изображения хранятся в папке images.
При использовании команды gulp build, вы получите минифицированные изображения в итоговой папке img.

В сборке добавлена поддержка форматов ```webp``` и ```avif```.
Используйте компонент ```images/modern.twig``` для подключения изображений
Компонент использует изображения 2x, не забудьте их добавить в папку к остальным изображениям.

Используйте миксин __image-set__ из ```mixins/image.scss``` для изображения в форматах ```webp``` и ```avif```.

TODO: Добавить svg спрайты

## Работа с иными ресурсами

Любые ресурсы (ассеты) проекта, под которые не отведена соответствующая папка, должны храниться в папке __assets__. Это могут быть видео-файлы,
php-файлы (как, например, файл отправки формы), favicon и прочие.

## Заключение

Спасибо всем, кто использует сборку! Если вы заметили какую-либо ошибку, пришлите пожалуйста issue с подробным описанием проблемы, я все смотрю и
постараюсь решить. Спасибо!
